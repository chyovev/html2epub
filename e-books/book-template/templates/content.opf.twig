<?xml version="1.0" encoding="UTF-8"?>
<package xmlns="http://www.idpf.org/2007/opf" version="2.0" unique-identifier="pub-id"
  prefix="dc: http://purl.org/dc/elements/1.1/">

    <metadata xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:opf="http://www.idpf.org/2007/opf" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:dc="http://purl.org/dc/elements/1.1/">
        <dc:title id="title">{{ book.title|e|trim }}</dc:title>
        {% if book.author %}
            <dc:creator id="author">{{ book.author|e|trim }}</dc:creator>
            <meta refines="#author" property="role" scheme="marc:relators">aut</meta>
        {% endif %}
        <dc:language id="language">{{ book.getLanguage().getLocale()|slice(0, 2) }}</dc:language>
        {% if book.publisher %}
            <dc:publisher>{{ book.publisher|e|trim }}</dc:publisher>
        {% endif %}
        {% if book.publisher or book.author %}
            <dc:rights>{{ book.publisher|default(book.author)|e|trim }}{% if book.year %}, {{ book.year|e|trim }}{% endif %}</dc:rights>
        {% endif %}
        <meta property="dc:contributor">HTML2ePub</meta>
        {% if book.isbn %}
            <dc:identifier id="isbn">urn:isbn:{{ book.isbn|e|trim }}</dc:identifier>
        {% endif %}
        <dc:date>{{ book.getCreatedAt('c') }}</dc:date>
        <meta property="dcterms:modified">{{ book.getUpdatedAt('c') }}</meta>
        {% if book.getCoverImageName() %}
            <meta name="cover" content="cover-image" />
        {% endif %}
    </metadata>

    <manifest>
        <item href="css/html2epub.css" id="stylesheet" media-type="text/css" />
        <item href="images/html2epub-logo.jpg" id="html2epub-logo" media-type="image/jpeg" />
        <item href="images/footnote-line.jpg" id="footnote-line" media-type="image/jpeg" />
        {% if book.getCoverImage() %}
            <item href="images/{{ fileName }}" id="cover-image" media-type="{{ mimeType }}" />
            <item href="coverpage.xhtml" id="coverpage" media-type="application/xhtml+xml" />
        {% endif %}
        <item href="titlepage.xhtml" id="titlepage" media-type="application/xhtml+xml" />
        {% if book.getDedication() %}
            <item href="dedication.xhtml" id="dedication" media-type="application/xhtml+xml" />
        {% endif %}
        {% for item in chapters %}
            <item href="{{ item.getPartNumber() }}.xhtml" id="{{ item.getPartNumber() }}" media-type="application/xhtml+xml" />
        {% endfor %}
        <item href="copyright.xhtml" id="copyright" media-type="application/xhtml+xml" />
        <item href="toc.ncx" id="ncx" media-type="application/x-dtbncx+xml" />
    </manifest>

    <spine toc="ncx">
        {% if book.getCoverImage() %}
            <itemref idref="coverpage"/>
        {% endif %}
        <itemref idref="titlepage"/>
        {% if book.getDedication() %}
            <itemref idref="dedication"/>
        {% endif %}
        {% for item in chapters %}
            <itemref idref="{{ item.getPartNumber() }}"/>
        {% endfor %}
        <itemref idref="copyright"/>
    </spine>

    <guide>
        {% if book.getCoverImage() %}
            <reference type="coverpage" title="Book Cover" href="coverpage.xhtml" />
        {% else %}
            <reference type="titlepage" title="Title Page" href="titlepage.xhtml" />
        {% endif %}
        {% for item in tree %}
            <reference type="text" title="{{ item.getTitle()|e|trim }}" href="{{ item.getPartNumber() }}.xhtml" />
        {% endfor %}
        <reference type="copyright-page" title="HTML2ePub" href="copyright.xhtml" />
    </guide>
</package>